generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OrderStatus {
  Pending
  Completed
  Cancelled
}

model Role {
  Id        String @id @default(uuid())
  RoleName  String @unique @db.VarChar(50)
  Users     User[]
  CreatedAt DateTime @default(now())
  UpdatedAt DateTime @updatedAt
}

model User {
  Id          String @id @default(uuid())
  Username    String @unique @db.VarChar(50)
  Password    String
  Email       String @unique @db.VarChar(100)
  PhoneNumber String? @db.VarChar(15)
  RoleId      String
  Role        Role @relation(fields: [RoleId], references: [Id], onDelete: Restrict)
  Orders      Order[]
  Reviews     Review[]
  CreatedAt   DateTime @default(now())
  UpdatedAt   DateTime @updatedAt
}

model Category {
  Id            String @id @default(uuid())
  CategoryName  String @db.VarChar(50)
  Products      Product[]
  CreatedAt     DateTime @default(now())
  UpdatedAt     DateTime @updatedAt
}

model Product {
  Id            String @id @default(uuid())
  ProductName   String @db.VarChar(100)
  Description   String? @db.Text
  Price         Decimal
  Stock         Int @default(0)
  CategoryId    String
  Category      Category @relation(fields: [CategoryId], references: [Id], onDelete: Restrict)
  OrderDetails  OrderDetail[]
  Reviews       Review[]
  CreatedAt     DateTime @default(now())
  UpdatedAt     DateTime @updatedAt
}

model Order {
  Id            String @id @default(uuid())
  UserId        String
  User          User @relation(fields: [UserId], references: [Id], onDelete: Restrict)
  OrderDate     DateTime @default(now())
  TotalAmount   Decimal
  OrderStatus   OrderStatus
  OrderDetails  OrderDetail[]
  CreatedAt     DateTime @default(now())
  UpdatedAt     DateTime @updatedAt
}

model OrderDetail {
  Id          String @id @default(uuid())
  OrderId     String
  Order       Order @relation(fields: [OrderId], references: [Id], onDelete: Restrict)
  ProductId   String
  Product     Product @relation(fields: [ProductId], references: [Id], onDelete: Restrict)
  Quantity    Int
  Price       Decimal
  CreatedAt   DateTime @default(now())
  UpdatedAt   DateTime @updatedAt
}

model Review {
  Id          String @id @default(uuid())
  UserId      String
  User        User @relation(fields: [UserId], references: [Id], onDelete: Restrict)
  ProductId   String
  Product     Product @relation(fields: [ProductId], references: [Id], onDelete: Restrict)
  Rating      Int
  Comment     String? @db.Text
  ReviewDate  DateTime @default(now())
}
